var LPNotifications=function(){var c="serviceworker registration timed out",f="serviceworker not defined in browser",l={};navigator.serviceWorker&&(navigator.serviceWorker.onmessage=function(i){(i.data.type=i.data.id)&&"function"==typeof l[i.data.id]&&l[i.data.id]()});var u=function(t){try{if(!t||!t.title||!t.message)throw"LPNotifications: error - missing title or message!";var o=t.title,i=t.message,e=t.callback||null,n=(Math.random()+1).toString(36).substring(2),r={body:i,icon:t.iconUrl||"images/icon80.png",tag:n,requireInteraction:!!e};if(!("Notification"in window))throw"LPNotifications: error - This browser does not support desktop notification";if("granted"===Notification.permission){lplog("LPNotifications (id="+n+"): title="+o+" text="+i);var a=function(){return navigator.serviceWorker?navigator.serviceWorker.ready:Promise.resolve(f)},s=new Promise(function(i){setTimeout(function(){i(c)},35e3)});Promise.race([a(),s]).then(function(i){i!==c&&i!==f?("function"==typeof e&&(l[n]=e,l[n].close=function(){}),i.active.postMessage({type:"notification-request",notificationTitle:o,notificationData:Object.assign({},r,{actions:[{action:"buttonPressed",title:t.buttonText||gs("Go to URL")}]})})):(l[n]=new Notification(o,r),l[n].onclick=function(){lplog("LPNotifications: user clicked notification id="+this.tag),e&&"function"==typeof e?e():(top.focus(),this.close())},l[n].onclose=function(){lplog("LPNotifications: closing notification id="+this.tag)})})}else"denied"!==Notification.permission?Notification.requestPermission().then(function(i){"granted"===i&&u(t)}):top.dialogs.alert.open({title:o,text:i,handler:function(i){i&&("function"==typeof e&&e(),i())}})}catch(i){console.error(i)}},i;return{createNotification:u,closeNotifications:function(){for(var i in l)l.hasOwnProperty(i)&&(l[i].close(),delete l[i])}}}();